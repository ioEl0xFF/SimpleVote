// =============================================================
// SimpleVote.solï¼ˆã‚³ãƒ¡ãƒ³ãƒˆä»˜ãï¼‰
// -------------------------------------------------------------
// ğŸ“ ã“ã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯ã€éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªã€Œè³›æˆï¼åå¯¾ã€æŠ•ç¥¨ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
// åˆå­¦è€…å‘ã‘ã«å„è¡Œã®å½¹å‰²ãƒ»æ›¸ãæ–¹ã‚’ä¸å¯§ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ã„ã¾ã™ã€‚
//   1. topic      : æŠ•ç¥¨ãƒ†ãƒ¼ãƒï¼ˆä¾‹ï¼šCats vs Dogsï¼‰
//   2. agree      : è³›æˆç¥¨ã®ç·æ•°
//   3. disagree   : åå¯¾ç¥¨ã®ç·æ•°
//   4. hasVoted   : æ—¢ã«æŠ•ç¥¨ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨˜éŒ²ã—ã¦äºŒé‡æŠ•ç¥¨ã‚’é˜²ã
//   5. vote()     : æŠ•ç¥¨ãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“
//   6. getVotes() : æŠ•ç¥¨çµæœã‚’å¤–éƒ¨ã‹ã‚‰èª­ã¿å–ã‚‹ãƒ“ãƒ¥ãƒ¼é–¢æ•°
// -------------------------------------------------------------

// SPDX-License-Identifier ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’æ˜ç¤ºã™ã‚‹ç‰¹åˆ¥ãªã‚³ãƒ¡ãƒ³ãƒˆã§ã™ã€‚
// ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã¨ã—ã¦å…¬é–‹ã™ã‚‹éš›ã«ã€ä½¿ç”¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆMIT ãªã©ï¼‰ã‚’æ›¸ãã¾ã™ã€‚
// ã“ã‚Œã‚’è¨˜è¼‰ã™ã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®è­¦å‘Šã‚’å›é¿ã§ãã¾ã™ã€‚
// SPDX-License-Identifier: MIT

// Solidity ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã€‚
// ã“ã“ã® ^0.8.30 ã¯ã€Œ0.8.30 ä»¥ä¸Š 0.9.0 æœªæº€ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚
pragma solidity ^0.8.30;

// â–¼ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆï¼ˆã‚¯ãƒ©ã‚¹ã®ã‚ˆã†ãªã‚‚ã®ï¼‰é–‹å§‹
contract SimpleVote {
    // =============================
    // ğŸ”¸ çŠ¶æ…‹å¤‰æ•°ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
    // =============================
    string public topic;   // æŠ•ç¥¨ãƒ†ãƒ¼ãƒã€‚public ä¿®é£¾å­ã§è‡ªå‹• Getter ãŒç”Ÿæˆã•ã‚Œã‚‹
    uint   public agree;   // è³›æˆç¥¨ã®ã‚«ã‚¦ãƒ³ã‚¿
    uint   public disagree;// åå¯¾ç¥¨ã®ã‚«ã‚¦ãƒ³ã‚¿

    // ã‚¢ãƒ‰ãƒ¬ã‚¹ => æŠ•ç¥¨æ¸ˆã¿ã‹ã©ã†ã‹ ã®ãƒãƒƒãƒ”ãƒ³ã‚°
    mapping(address => bool) public hasVoted;

    // =============================
    // ğŸ”¸ ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼
    // =============================
    // ã‚¬ã‚¹ã‚’ç¯€ç´„ã§ãã‚‹ revert æ–¹æ³•ã€‚require ã‚ˆã‚ŠåŠ¹ç‡çš„ï¼†ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‹å®‰å…¨ã€‚
    error AlreadyVoted();

    // =============================
    // ğŸ”¸ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
    // =============================
    // ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«æŠ•ç¥¨ãƒ†ãƒ¼ãƒã‚’å—ã‘å–ã‚Šã€çŠ¶æ…‹å¤‰æ•° topic ã«ä¿å­˜ã—ã¾ã™ã€‚
    constructor(string memory _topic) {
        topic = _topic;
    }

    // =============================
    // ğŸ”¸ ãƒ¡ã‚¤ãƒ³é–¢æ•°: vote()
    // =============================
    /// @notice è³›æˆ( true ) ã‹ åå¯¾( false ) ã‚’é€ä¿¡è€…ãŒæŠ•ç¥¨ã—ã¾ã™ã€‚
    /// @param agreeVote true ã§è³›æˆã€false ã§åå¯¾ã€‚
    function vote(bool agreeVote) external {
        // â‘  äºŒé‡æŠ•ç¥¨ãƒã‚§ãƒƒã‚¯ï¼šæ—¢ã«æŠ•ç¥¨ã—ã¦ã„ã‚Œã° revert ã§å‡¦ç†ã‚’ä¸­æ–­
        if (hasVoted[msg.sender]) {
            revert AlreadyVoted();
        }
        // â‘¡ æŠ•ç¥¨æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        hasVoted[msg.sender] = true;

        // â‘¢ å…¥åŠ›ã«å¿œã˜ã¦ã‚«ã‚¦ãƒ³ã‚¿ã‚’å¢—ã‚„ã™
        if (agreeVote) {
            // è³›æˆç¥¨ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
            agree++;
        } else {
            // åå¯¾ç¥¨ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
            disagree++;
        }
    }

    // =============================
    // ğŸ”¸ ãƒ“ãƒ¥ãƒ¼é–¢æ•°: getVotes()
    // =============================
    /// @notice ç¾åœ¨ã®è³›æˆç¥¨æ•°ã¨åå¯¾ç¥¨æ•°ã‚’å–å¾—ã—ã¾ã™ã€‚
    /// @return uint è³›æˆç¥¨, uint åå¯¾ç¥¨
    function getVotes() external view returns (uint, uint) {
        return (agree, disagree);
    }
}
