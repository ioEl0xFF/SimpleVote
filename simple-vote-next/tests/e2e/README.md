# SimpleVote E2Eテスト - ウォレット接続機能

## 概要

このディレクトリには、SimpleVoteアプリケーションのウォレット接続機能に関するE2Eテストが含まれています。

## テストファイル

### `wallet-connection.spec.ts`

ウォレット接続機能の包括的なテストスイートです。

#### テストケース一覧

1. **ウォレット接続ボタンの表示**
   - 接続前の状態でボタンが表示される
   - ボタンのテキストが正しく表示される
   - ボタンがクリック可能である
   - ボタンのスタイルが正しく適用されている

2. **ウォレット接続プロセス - 成功ケース**
   - MetaMaskなどのウォレットが検出される
   - 接続成功時にウォレットアドレスが表示される
   - 切断ボタンが表示される
   - 成功メッセージが表示される
   - 投票一覧が表示される

3. **ウォレット接続プロセス - MetaMask未インストール**
   - MetaMaskが未インストールの状態でのエラーハンドリング

4. **ウォレット切断機能**
   - 切断ボタンの表示とスタイル確認
   - 切断後の状態リセット

5. **接続失敗時のエラーハンドリング**
   - ユーザー拒否
   - ネットワークエラー
   - 署名拒否

6. **アクセシビリティ**
   - キーボードナビゲーション
   - スクリーンリーダー対応

7. **レスポンシブデザイン**
   - デスクトップ表示（1920x1080）
   - モバイル表示（375x667）

8. **その他の機能**
   - トーストメッセージの自動消去
   - 複数回の接続・切断
   - ページタイトルの表示
   - ウォレット接続状態の永続性
   - 同時接続の制限
   - エラーメッセージの詳細性

## ヘルパー関数

### `../helpers/wallet-test-utils.ts`

テストの保守性を向上させるためのヘルパー関数が含まれています。

#### 主要な関数

- `mockMetaMaskInstalled(page)` - MetaMaskがインストールされている状態をシミュレート
- `mockMetaMaskNotInstalled(page)` - MetaMaskが未インストールの状態をシミュレート
- `mockWalletRejection(page, errorMessage)` - ウォレット接続を拒否する状態をシミュレート
- `mockSignatureRejection(page)` - 署名を拒否する状態をシミュレート
- `mockNetworkError(page, errorMessage)` - ネットワークエラーをシミュレート
- `connectWallet(page)` - ウォレット接続を実行
- `disconnectWallet(page)` - ウォレット切断を実行
- `checkConnectButtonStyles(page)` - 接続ボタンのスタイル確認
- `checkDisconnectButtonStyles(page)` - 切断ボタンのスタイル確認
- `testResponsiveDesign(page, viewport)` - レスポンシブデザインのテスト
- `testKeyboardNavigation(page)` - キーボードナビゲーションのテスト

## テスト実行方法

```bash
# ウォレット接続機能のテストのみ実行
npm run test:e2e -- --grep "ウォレット接続機能"

# ヘッドレスモードで実行
npm run test:e2e -- --grep "ウォレット接続機能" --headless

# デバッグモードで実行
npm run test:e2e -- --grep "ウォレット接続機能" --debug
```

## テストデータ

テストでは以下のモックデータを使用しています：

- テスト用ウォレットアドレス: `0x1234567890123456789012345678901234567890`
- テスト用署名: `0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef`

## 注意事項

1. **ウォレット接続のシミュレーション**: 実際のMetaMaskとの接続は行わず、`window.ethereum`オブジェクトをモックしてテストしています。

2. **永続化機能**: 現在の実装ではウォレット接続状態の永続化は実装されていないため、ページリロード後は接続状態がリセットされます。

3. **エラーハンドリング**: 様々なエラーパターン（ユーザー拒否、ネットワークエラー、署名拒否）をテストしています。

4. **アクセシビリティ**: キーボードナビゲーションとスクリーンリーダー対応をテストしています。

## 今後の改善点

1. **永続化機能の実装**: ウォレット接続状態をローカルストレージに保存する機能の追加
2. **より多くのエラーパターン**: 追加のエラーケースのテスト
3. **パフォーマンステスト**: 接続・切断の速度測定
4. **セキュリティテスト**: ウォレット接続のセキュリティ面のテスト

## チェックリスト対応

このテストは `docs/playwright-test-checklist.md` の以下の項目に対応しています：

- [x] ウォレット接続ボタンの表示
- [x] ウォレット接続プロセス
- [x] ウォレット切断機能
- [x] 接続失敗時のエラーハンドリング
- [x] アクセシビリティ（キーボードナビゲーション、スクリーンリーダー対応）
- [x] レスポンシブデザイン（デスクトップ、モバイル） 