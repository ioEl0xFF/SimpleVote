# トランザクション完了後の処理が止まる問題の原因と修正方法

## 問題の概要

投票作成時、トランザクション送信後に「トランザクション承認待ち…」のまま止まり、「議題を作成しました」メッセージが表示されない問題が発生していた。

## 原因

- モックの`PollCreated`イベントのシグネチャ（topics[0]）が、コントラクトABIの定義と一致していなかった。
- アプリ側では`registry.interface.parseLog(log)`でイベントをパースしているが、シグネチャが異なるためパースに失敗し、`PollCreated`イベントが検知できなかった。
- その結果、投票作成完了のトーストが表示されず、処理が止まって見える状態となっていた。

## 修正方法

1. **モックのイベントシグネチャを正しくする**
    - コントラクトABIの定義通り、`PollCreated(uint256,uint8,address,string)`のシグネチャハッシュを計算し、
      モックの`topics[0]`にセットする。
    - これにより、アプリ側の`parseLog`が正常に動作し、イベント検知・トースト表示が正しく行われる。

2. **修正例（モックの一部抜粋）**

```js
// 正しいイベントシグネチャを計算
const pollCreatedSignature = ethers.id('PollCreated(uint256,uint8,address,string)');

// モックのイベントログで使用
logs: [
  {
    topics: [
      pollCreatedSignature, // 正しいシグネチャをセット
      '0x...pollId',
      '0x...owner',
    ],
    ...
  }
]
```

## 結果

- テスト実行時、「トランザクション承認待ち…」のまま止まることなく、「議題を作成しました」メッセージが表示されるようになった。
- トランザクション完了後の処理が正常に動作することを確認。 