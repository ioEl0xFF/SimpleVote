# BigNumberishã‚¨ãƒ©ãƒ¼åŸå› èª¿æŸ»çµæœã¨ä¿®æ­£æ–¹æ³•

## æ¦‚è¦

SimpleVoteã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«ç™ºç”Ÿã—ã¦ã„ãŸã€Œinvalid BigNumberish valueã€ã‚¨ãƒ©ãƒ¼ã®åŸå› ã‚’ç‰¹å®šã—ã€ä¿®æ­£æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

## ã‚¨ãƒ©ãƒ¼ã®è©³ç´°

### ç™ºç”ŸçŠ¶æ³
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `TypeError: invalid BigNumberish value (argument="%response", value=null, code=INVALID_ARGUMENT, version=6.14.4)`
- **ç™ºç”Ÿç®‡æ‰€**: ethers.jsã®`BrowserProvider.estimateGas`ãƒ¡ã‚½ãƒƒãƒ‰å†…
- **å½±éŸ¿ç¯„å›²**: ã™ã¹ã¦ã®æŠ•ç¥¨ä½œæˆãƒ†ã‚¹ãƒˆï¼ˆDynamic Voteã€Weighted Voteã€Simple Voteï¼‰

### ã‚¨ãƒ©ãƒ¼ã®ç‰¹å¾´
- ethers.jsã®å†…éƒ¨å‡¦ç†ã§`getBigInt(null)`ãŒå‘¼ã°ã‚Œã¦ç™ºç”Ÿ
- ãƒ¢ãƒƒã‚¯ç’°å¢ƒã§ã®ã¿ç™ºç”Ÿ
- å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆã¯æ­£å¸¸

## åŸå› ã®ç‰¹å®š

### èª¿æŸ»æ‰‹é †
1. **è©³ç´°ãƒ­ã‚°ã®è¿½åŠ **: ethers-mock.tsã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã«ãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ 
2. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ç¢ºèª**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
3. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¿½è·¡**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ¢ãƒƒã‚¯ã¾ã§ã®å€¤ã®æµã‚Œã‚’ç¢ºèª

### èª¿æŸ»çµæœ

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæ­£å¸¸ï¼‰
```javascript
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
{
  pollTypeEnum: 0,           // numberå‹
  topic: "ãƒ†ã‚¹ãƒˆæŠ•ç¥¨",        // stringå‹
  s: 1751364180,            // numberå‹ï¼ˆUNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  eTime: 1751367780,        // numberå‹ï¼ˆUNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  filteredChoices: ["é¸æŠè‚¢1", "é¸æŠè‚¢2"], // string[]å‹
  tokenAddress: "0x0000000000000000000000000000000000000000" // stringå‹
}
```

#### å•é¡Œã®ç™ºç”Ÿç®‡æ‰€
```javascript
// ethers.jsã®å†…éƒ¨å‡¦ç†ã§ç™ºç”Ÿ
BrowserProvider.estimateGas() {
  // eth_estimateGasã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒnullã®å ´åˆ
  const gasEstimate = null;
  return getBigInt(gasEstimate); // â† ã“ã“ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
}
```

### æ ¹æœ¬åŸå› 
**ethers-mock.tsã®`ethereum.request`ã§`eth_estimateGas`ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ¢ãƒƒã‚¯ãŒæœªå®Ÿè£…ã ã£ãŸãŸã‚ã€`null`ã‚’è¿”ã—ã¦ã„ãŸã€‚**

```javascript
// å•é¡Œã®ã‚ã£ãŸã‚³ãƒ¼ãƒ‰
switch (args.method) {
    case 'eth_blockNumber':
        return '0x123456';
    default:
        console.log('Unknown method:', args.method);
        return null; // â† eth_estimateGasãŒã“ã“ã«è©²å½“
}
```

## ä¿®æ­£æ–¹æ³•

### ä¿®æ­£å†…å®¹
ethers-mock.tsã®`ethereum.request`ã«å¿…è¦ãªãƒ¢ãƒƒã‚¯ã‚’è¿½åŠ 

```javascript
// ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰
switch (args.method) {
    case 'eth_blockNumber':
        console.log('Returning mock block number: 0x123456');
        return '0x123456';
    case 'eth_estimateGas':
        console.log('Returning mock gas estimate: 0x186A0');
        return '0x186A0'; // â† é©å½“ãªã‚¬ã‚¹å€¤ã‚’è¿”ã™
    case 'eth_sendTransaction':
        console.log('Returning mock transaction hash: 0x1234567890...');
        return '0x1234567890123456789012345678901234567890123456789012345678901234';
    case 'eth_getTransactionByHash':
        console.log('Returning mock transaction receipt');
        return {
            hash: '0x1234567890123456789012345678901234567890123456789012345678901234',
            from: '0x1234567890123456789012345678901234567890',
            to: '0x0000000000000000000000000000000000000000',
            gasLimit: '0x186A0',
            value: '0x0',
            nonce: '0x1',
            data: '0x',
            status: 1,
            logs: [/* PollCreatedã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ­ã‚° */]
        };
    default:
        console.log('Unknown method:', args.method);
        return null;
}
```

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `simple-vote-next/tests/helpers/ethers-mock.ts`
- **ä¿®æ­£ç®‡æ‰€**: `ethereum.request`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®switchæ–‡

## ä¿®æ­£ã®åŠ¹æœ

### ä¿®æ­£å‰
- `eth_estimateGas`ãŒ`null`ã‚’è¿”ã™
- ethers.jsãŒ`getBigInt(null)`ã‚’å®Ÿè¡Œ
- ã€Œinvalid BigNumberish valueã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- ã™ã¹ã¦ã®æŠ•ç¥¨ä½œæˆãƒ†ã‚¹ãƒˆãŒå¤±æ•—

### ä¿®æ­£å¾Œ
- `eth_estimateGas`ãŒé©åˆ‡ãªã‚¬ã‚¹å€¤ï¼ˆ`0x186A0`ï¼‰ã‚’è¿”ã™
- ethers.jsãŒæ­£å¸¸ã«BigIntå¤‰æ›ã‚’å®Ÿè¡Œ
- BigNumberishã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆ
- ãƒ†ã‚¹ãƒˆãŒã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰¿èªå¾…ã¡â€¦ã€ã¾ã§é€²è¡Œ

## ä¿®æ­£å®Œäº†çŠ¶æ³

### âœ… è§£æ±ºæ¸ˆã¿
1. **BigNumberishã‚¨ãƒ©ãƒ¼**: å®Œå…¨ã«è§£æ¶ˆ
2. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡**: æ­£å¸¸ã«å‹•ä½œ
3. **ã‚¬ã‚¹æ¨å®š**: æ­£å¸¸ã«å‹•ä½œ
4. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ã‚·ãƒ¼ãƒˆ**: å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã™ã¹ã¦è¿½åŠ 

### ğŸ”„ ç¾åœ¨ã®çŠ¶æ³
ãƒ†ã‚¹ãƒˆã¯ã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰¿èªå¾…ã¡â€¦ã€ã®çŠ¶æ…‹ã¾ã§æ­£å¸¸ã«é€²ã‚“ã§ã„ã¾ã™ã€‚ã“ã‚Œã¯åŸºæœ¬çš„ãªæŠ•ç¥¨ä½œæˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### ğŸ“‹ æ®‹ã‚Šã®èª²é¡Œ
ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã®å‡¦ç†ï¼ˆã€Œè­°é¡Œã‚’ä½œæˆã—ã¾ã—ãŸã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºï¼‰ã«ã¤ã„ã¦ã¯ã€åˆ¥é€”èª¿æŸ»ãŒå¿…è¦ã§ã™ã€‚

## æ•™è¨“ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒ¢ãƒƒã‚¯ã®å®Œå…¨æ€§
- ethers.jsã®ãƒ¢ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€å®Ÿéš›ã®ethers.jsãŒå‘¼ã³å‡ºã™ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ç‰¹ã«`estimateGas`ã€`sendTransaction`ã€`getTransactionByHash`ãªã©ã¯å¿…é ˆ
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ã‚·ãƒ¼ãƒˆã«ã¯`from`ã€`to`ã€`gasLimit`ã€`value`ã€`nonce`ã€`data`ã€`status`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…è¦

### 2. ã‚¨ãƒ©ãƒ¼ã®æ®µéšçš„èª¿æŸ»
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆã‚’ç¢ºèª
- ethers.jsã®å†…éƒ¨å‡¦ç†ã‚’è¿½è·¡
- ãƒ¢ãƒƒã‚¯ã®æˆ»ã‚Šå€¤ã‚’æ¤œè¨¼

### 3. ãƒ­ã‚°å‡ºåŠ›ã®é‡è¦æ€§
- è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã«ã‚ˆã‚Šã€å•é¡Œã®ç‰¹å®šãŒå¤§å¹…ã«åŠ¹ç‡åŒ–ã•ã‚ŒãŸ
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ãŒæœ‰åŠ¹

## çµè«–

BigNumberishã‚¨ãƒ©ãƒ¼ã®åŸå› ã¯ã€ethers.jsã®`estimateGas`ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ¢ãƒƒã‚¯ãŒæœªå®Ÿè£…ã§`null`ã‚’è¿”ã—ã¦ã„ãŸã“ã¨ã§ã—ãŸã€‚é©åˆ‡ãªã‚¬ã‚¹å€¤ã‚’è¿”ã™ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã€ã‚¨ãƒ©ãƒ¼ã¯è§£æ¶ˆã•ã‚Œã¾ã—ãŸã€‚

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã¯ã€Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰¿èªå¾…ã¡â€¦ã€ã¾ã§é€²è¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€åŸºæœ¬çš„ãªæŠ•ç¥¨ä½œæˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `simple-vote-next/tests/helpers/ethers-mock.ts` - ãƒ¢ãƒƒã‚¯å®Ÿè£…
- `simple-vote-next/app/create/page.tsx` - æŠ•ç¥¨ä½œæˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- `simple-vote-next/tests/poll-creation.spec.ts` - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- `docs/development/testing/bignumberish-error-investigation-guide.md` - èª¿æŸ»æ‰‹é †æ›¸